logindata = {"taskid": 1543563816, "type": "login", "err": 0, "data": {"uid": "6999832666", "st": "b067ed", "cookies": "#LWP-Cookies-2.0\nSet-Cookie3: ALF=1558770847; path=\"/\"; domain=\".97973.com\"; path_spec; domain_dot; expires=\"2019-05-25 07:54:07Z\"; version=0\nSet-Cookie3: SSOLoginState=1556178847; path=\"/\"; domain=\".97973.com\"; path_spec; discard; version=0\nSet-Cookie3: ALC=\"ac%3D2%26bt%3D1556178846%26cv%3D5.0%26et%3D1587714846%26ic%3D-562032854%26login_time%3D1556178846%26scf%3D%26uid%3D6999832666%26vf%3D0%26vs%3D0%26vt%3D0%26es%3Df5bcd370bffd7aaa9f7596960683a82c\"; path=\"/\"; domain=\".login.sina.com.cn\"; path_spec; expires=\"2020-04-24 07:54:06Z\"; httponly=None; version=0\nSet-Cookie3: LT=1556178847; path=\"/\"; domain=\".login.sina.com.cn\"; path_spec; discard; version=0\nSet-Cookie3: tgc=\"TGT-Njk5OTgzMjY2Ng==-1556178846-tc-92E9B2D0050EBD20322521408BC740B0-1\"; path=\"/\"; domain=\".login.sina.com.cn\"; path_spec; discard; Httponly=None; version=0\nSet-Cookie3: XSRF-TOKEN=b067ed; path=\"/\"; domain=\".m.weibo.cn\"; path_spec; discard; version=0\nSet-Cookie3: SRF=1556178847; path=\"/\"; domain=\".passport.weibo.com\"; path_spec; domain_dot; expires=\"2029-04-22 07:54:07Z\"; version=0\nSet-Cookie3: SRT=\"D.QqHBJZPt5EHcO!Mb4cYGS4HziFoqdZYu5!kwPGEHNEYd43i3imSpMERt4EPKRcsrA4kJdFbjTsVuObESN!Ho5DWI54iGWsyjJruG43YJWdsENZEb5DbsAcbq*B.vAflW-P9Rc0lR-ykTDvnJqiQVbiRVPBtS!r3JZPQVqbgVdWiMZ4siOzu4DbmKPVsU44rJPyBTcPzOPED4-f3Q-kDRro-i49ndDPIJcYPSrnlMcyoiDEIIbHbJG9Z4-yoJcM1OFyHi3bgVdWJT-4n5ZBOAeMr\"; path=\"/\"; domain=\".passport.weibo.com\"; path_spec; domain_dot; expires=\"2029-04-22 07:54:07Z\"; httponly=None; version=0\nSet-Cookie3: ALF=1587714846; path=\"/\"; domain=\".sina.com.cn\"; path_spec; domain_dot; expires=\"2020-04-24 07:54:06Z\"; version=0\nSet-Cookie3: SCF=\"AixxSkEEZRJViO7-e_DFCAAGpZeKDMT9zRYQirm0DjjEmsmMH8ccN5oanoRpBmqLnHUFOgHHS6gV6AWZD56qpPk.\"; path=\"/\"; domain=\".sina.com.cn\"; path_spec; domain_dot; expires=\"2029-04-22 07:54:06Z\"; httponly=None; version=0\nSet-Cookie3: SUB=_2A25xxRfPDeRhGeBH4lsZ8yzKzTqIHXVTSbmHrDV_PUJbm9AKLWTAkW1NQYJBq3r2w7nxtRjD88OpL1OH0e2I70Yg; path=\"/\"; domain=\".sina.com.cn\"; path_spec; domain_dot; expires=\"2020-04-24 07:54:07Z\"; HttpOnly=None; version=0\nSet-Cookie3: SUBP=\"0033WrSXqPxfM725Ws9jqgMF55529P9D9W5mE41_AjeHMQCSj7_kCcLv5NHD95Qc1K.41heESoqcWs4Dqcjzds8DP0eEe0-t\"; path=\"/\"; domain=\".sina.com.cn\"; path_spec; domain_dot; discard; version=0\nSet-Cookie3: ULOGIN_IMG=\"tc-124bcf0f33c3d917b161b5aa20587f94aa0b\"; path=\"/\"; domain=\".sina.com.cn\"; path_spec; domain_dot; discard; version=0\nSet-Cookie3: sso_info=\"v02m6alo5qztayYlqWfjLOIs42SmbWalpC9jaOkuY6ToLOMo5i2jaDAwA==\"; path=\"/\"; domain=\".sina.com.cn\"; path_spec; domain_dot; expires=\"2020-04-25 07:54:06Z\"; version=0\nSet-Cookie3: ALF=1558770847; path=\"/\"; domain=\".weibo.cn\"; path_spec; domain_dot; expires=\"2019-05-25 07:54:07Z\"; version=0\nSet-Cookie3: MLOGIN=1; path=\"/\"; domain=\".weibo.cn\"; path_spec; domain_dot; expires=\"2019-04-25 08:54:07Z\"; version=0\nSet-Cookie3: M_WEIBOCN_PARAMS=\"luicode%3D20000174\"; path=\"/\"; domain=\".weibo.cn\"; path_spec; domain_dot; expires=\"2019-04-25 08:04:07Z\"; HttpOnly=None; version=0\nSet-Cookie3: SCF=\"AixxSkEEZRJViO7-e_DFCAAGpZeKDMT9zRYQirm0DjjEQi-xsveHpcQwoEQ8LPf2XTvTuV9uWBnlnv6Oxsw7-cM.\"; path=\"/\"; domain=\".weibo.cn\"; path_spec; domain_dot; expires=\"2029-04-22 07:54:07Z\"; httponly=None; version=0\nSet-Cookie3: SSOLoginState=1556178847; path=\"/\"; domain=\".weibo.cn\"; path_spec; discard; version=0\nSet-Cookie3: SUB=\"_2A25xxRfPDeRhGeBH4lsZ8yzKzTqIHXVTSbmHrDV6PUJbktAKLWHskW1NQYJBqwI3HMtLfOYRoat6IV5jkZf49-XT\"; path=\"/\"; domain=\".weibo.cn\"; path_spec; domain_dot; expires=\"2020-04-24 07:54:07Z\"; HttpOnly=None; version=0\nSet-Cookie3: SUBP=\"0033WrSXqPxfM725Ws9jqgMF55529P9D9W5mE41_AjeHMQCSj7_kCcLv5JpX5K-hUgL.Foq41K.Re0zcSoq2dJLoI7yjqgLke0z0SBtt\"; path=\"/\"; domain=\".weibo.cn\"; path_spec; domain_dot; expires=\"2020-04-24 07:54:07Z\"; version=0\nSet-Cookie3: SUHB=06ZVzNH1gRGaeS; path=\"/\"; domain=\".weibo.cn\"; path_spec; domain_dot; expires=\"2020-04-24 07:54:07Z\"; version=0\nSet-Cookie3: WEIBOCN_FROM=1110003030; path=\"/\"; domain=\".weibo.cn\"; path_spec; domain_dot; discard; HttpOnly=None; version=0\nSet-Cookie3: _T_WM=17355580790; path=\"/\"; domain=\".weibo.cn\"; path_spec; domain_dot; expires=\"2019-05-05 07:54:02Z\"; version=0\nSet-Cookie3: ALF=1587714846; path=\"/\"; domain=\".weibo.com\"; path_spec; domain_dot; expires=\"2020-04-24 07:54:06Z\"; version=0\nSet-Cookie3: SCF=\"AixxSkEEZRJViO7-e_DFCAAGpZeKDMT9zRYQirm0DjjEmsmMH8ccN5oanoRpBmqLnFTLzral7PdHhR29Dk1b5i0.\"; path=\"/\"; domain=\".weibo.com\"; path_spec; domain_dot; expires=\"2029-04-22 07:54:06Z\"; httponly=None; version=0\nSet-Cookie3: SSOLoginState=1556178847; path=\"/\"; domain=\".weibo.com\"; path_spec; domain_dot; discard; version=0\nSet-Cookie3: SUB=_2A25xxRfNDeRhGeBH4lsZ8yzKzTqIHXVSsw4FrDV8PUNbmtAKLXilkW9NQYJBqx7KyCGw_l3NGSxLumEJ1ex9uBis; path=\"/\"; domain=\".weibo.com\"; path_spec; domain_dot; discard; HttpOnly=None; version=0\nSet-Cookie3: SUBP=\"0033WrSXqPxfM725Ws9jqgMF55529P9D9W5mE41_AjeHMQCSj7_kCcLv5JpX5K2hUgL.Foq41K.Re0zcSoq2dJLoI7yjqgLke0z0SBtt\"; path=\"/\"; domain=\".weibo.com\"; path_spec; domain_dot; expires=\"2020-04-24 07:54:07Z\"; version=0\nSet-Cookie3: SUHB=\"0OM08-yv6Fzxit\"; path=\"/\"; domain=\".weibo.com\"; path_spec; domain_dot; expires=\"2020-04-24 07:54:07Z\"; version=0\nSet-Cookie3: login=a902e3917463c16c83238d20c9245191; path=\"/\"; domain=\"login.sina.com.cn\"; path_spec; discard; version=0\nSet-Cookie3: login=f656a41107fa6197509ed6d05b9390fd; path=\"/\"; domain=\"passport.97973.com\"; path_spec; discard; version=0\nSet-Cookie3: login=f656a41107fa6197509ed6d05b9390fd; path=\"/\"; domain=\"passport.weibo.cn\"; path_spec; discard; version=0\nSet-Cookie3: login=13a0857768fc0c0abafd3d70c0f4538a; path=\"/\"; domain=\"passport.weibo.com\"; path_spec; discard; version=0\n", "username": "lai_323@163.com", "password": "shamao123"}, "reason": "done"}


uid = logindata['data']['uid']
st = logindata['data']['st']
cookies = logindata['data']['cookies']

taskPv = {
  "code": 0,
  "message": "操作成功",
  "data": {
    "taskid": 1543563816,
    "type": "pv",
    "timeout": 300,
    "params": {
      "targeturl": "https://weibo.com/6829531006/HbUbUfsch",
      # "targeturl": "https://weibo.com/5846555329/HcODpoMWh",
      "count": 100
    }
  }
}


mixTask = {
  "code": 0,
  "message": "操作成功",
  "data": {
    "taskid": 1543563816,
    "type": "mix",
    "timeout": 3000,
    "params": {
      "uid": uid,
      "st": st,
      "cookies": cookies,
      "tasks": [
        # // 评论
        {
          "taskid": 1,
          "type": "fast_comment",
          "params": {
            "targetmid": 4345461655378681,
            "content": "comment test..."
          }
        },
        # // 转发
        {
          "taskid": 2,
          "type": "fast_repost",
          "params": {
            "targetid": 4345461655378681,
            "targetmid": 4345461655378681,
            "content": "",
            "dualPost": False
          }
        },
        # // 点赞
        {
          "taskid": 3,
          "type": "fast_heart",
          "params": {
            "targetid": 4345461655378681
          }
        }
      ],
    }
  }
}

import json
import tornado.ioloop
import tornado.web
import sinaRequests as requests
from bots.pvBot import PvBot
from bots.mixBot import MixBot
from taskloop import showWorkerResult
import utils, config

utils.initlog(config.LOG_LEVEL, filename=None, sendSyslog=True)

def test_pv():
    taskid = 1543563816
    params = {
      "targeturl": "https://weibo.com/6829531006/HbUbUfsch",
      "count": 20,
      "timeout": 500
    }
    bot = PvBot(taskid, params)
    bot.run()
    showWorkerResult(bot)
    return [{'type':'pv', 'reason': bot.reason}]


def test_mix():
    taskid = 1543563816
    params = mixTask['data']['params']
    bot = MixBot(taskid, params)
    bot.run()
    showWorkerResult(bot)
    reasons = []
    for i in bot.data['datas']:
        reasons.append({
            'type':i['type'],
            'reason': i['reason']
        })
    return reasons
def test():
    reasons_pv = test_pv()
    reasons = test_mix()
    reasons += reasons_pv
    for i in reasons:
        print (i['type'], i['reason'])
        if i['reason'] == config.REASON['bot_run_error']:
            print('!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!')
            print('error')
            print('!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!')
            return
    print('!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!')
    print('ok')
    print('!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!')
    
    


if __name__ == "__main__":
    test()